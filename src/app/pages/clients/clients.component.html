<div class="container">
  <app-viewer [title]="'Clients data'">
    <div class="table-wrapper">
      <div class="table-header"></div>

      <div class="table-content">
        <table class="sticky-header tb-min-width selectable">
          <thead>
            <tr>
              <th *ngFor="let column of clientsColumn">{{ column | translate }}</th>
              <th>
                <button [disabled]="isCreatingClient" (click)="handleAddClient()" class="sdwi-button">
                  {{ 'BUTTONS.ADD_NEW' | translate}}
                </button>
              </th>
            </tr>
            <!-- <tr>
              <th *ngFor="let type of dessertTableFilters">
                <app-table-filter-item [type]="type"></app-table-filter-item>
              </th>
              <th>
                <button class="sdwi-button">Add new</button>
              </th>
            </tr> -->
          </thead>
          <tbody>
            <ng-container #clientCreateCnt></ng-container>
            <tr *ngFor="let client of clients; let i = index">
              <ng-container [ngTemplateOutletContext]="{ index: i, client: client, isCreateView: false }" [ngTemplateOutlet]="
                  i === editRowIndex ? rowFormTpl : rowDisplayTpl
                "></ng-container>
            </tr>
            <app-spinner-wrapper *ngIf="!clients" name="clients-base-table" title="Loading, please wait">
            </app-spinner-wrapper>
            <app-empty-table-state *ngIf="!isCreatingClient && clients ? !clients.length : false"></app-empty-table-state>
          </tbody>
        </table>
      </div>
    </div>
  </app-viewer>
</div>

<ng-template #rowDisplayTpl let-client="client" let-index="index">
  <td>{{ client.fullName }}</td>
  <td>{{ client.DOB | localDate:'shortDate' }}</td>
  <td><a [href]="client.email | anchorLinkFormat" class="link">{{ client.email }}</a></td>
  <td><a [href]="client.phoneNumber | mask:phoneNumberMask | anchorLinkFormat:'tel'"
      class="link">{{ client.phoneNumber | mask:phoneNumberMask }}</a>
  </td>
  <td>{{ client.lastSeenDate | localDate:'short' }}</td>
  <td>{{ client.lastTransactionDate | localDate:'short' }}</td>
  <td>{{ client.account | currency:'RUB':'symbol-narrow':'1.1' }}</td>
  <td>
    <app-client-status [status]="client.status"></app-client-status>
  </td>
  <td>
    <div class="cell-buttons">
      <button (click)="handleShowEditModel(index, client)" class="sdwi-button danger">
        {{ 'BUTTONS.EDIT' | translate}}
      </button>
      <button (click)="handleDeleteDessert(client.id)" class="sdwi-button">
        {{ 'BUTTONS.REMOVE' | translate}}
      </button>
    </div>
  </td>
</ng-template>

<ng-template #rowFormTpl let-isCreateView="isCreateView" let-client="client">
  <ng-container *ngTemplateOutlet="commonFormTpl; context: {client: client}"></ng-container>
  <ng-container *ngIf="isCreateView; else elseTemplate">
    <td>
      <div class="cell-buttons">
        <button (click)="handleCreate()" class="sdwi-button">
          {{ 'BUTTONS.CREATE' | translate}}
        </button>
        <button (click)="handleCancelCreate()" class="sdwi-button">
          {{ 'BUTTONS.CANCEL' | translate}}
        </button>
      </div>
    </td>
  </ng-container>
  <ng-template #elseTemplate>
    <td>
      <div class="cell-buttons">
        <button (click)="handleUpdateRow(client)" class="sdwi-button">
          {{'BUTTONS.UPDATE' | translate}}
        </button>
        <button (click)="handleCancelEdit()" class="sdwi-button">
          {{'BUTTONS.CANCEL'  | translate }}</button>
      </div>
    </td>
  </ng-template>
</ng-template>

<ng-template #commonFormTpl let-client="client">
  <td>
    <app-form-field class="no-label">
      <input #controlAnchor [formControl]="clientForm.controls.fullName" class="sdwi-input" type="text" />
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <app-date-input #controlAnchor [formControl]="clientForm.controls.DOB"
        [placeholder]="'PLACEHOLDER.DATE' | translate"></app-date-input>
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <input #controlAnchor [formControl]="clientForm.controls.email" class="sdwi-input" />
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <input #controlAnchor [mask]="phoneNumberMask" [formControl]="clientForm.controls.phoneNumber"
        class="sdwi-input" />
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <app-date-input #controlAnchor [formControl]="clientForm.controls.lastSeenDate" dateTime="true"
        [placeholder]="'PLACEHOLDER.DATE_TIME' | translate"></app-date-input>
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <app-date-input #controlAnchor [formControl]="clientForm.controls.lastTransactionDate" dateTime="true"
        [placeholder]="'PLACEHOLDER.DATE_TIME' | translate"></app-date-input>
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <input #controlAnchor suffix="$" mask="separator.2" [formControl]="clientForm.controls.account"
        class="sdwi-input" />
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <app-select #controlAnchor [formControl]="clientForm.controls.status">
        <app-option *ngFor="let option of statusOptions" [value]="option.value">{{option.viewValue  | translate}}</app-option>
      </app-select>
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
</ng-template>








<!-- ******************************************************* -->
<ng-template #rowEditTpl let-client="client">
  <td>
    <app-form-field class="no-label">
      <input #controlAnchor [formControl]="clientForm.controls.fullName" class="sdwi-input" type="text" />
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <app-date-input #controlAnchor [formControl]="clientForm.controls.DOB"
        [placeholder]="'PLACEHOLDER.DATE' | translate"></app-date-input>
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <input #controlAnchor [formControl]="clientForm.controls.email" class="sdwi-input" />
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <input #controlAnchor [mask]="phoneNumberMask" [formControl]="clientForm.controls.phoneNumber"
        class="sdwi-input" />
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <app-date-input #controlAnchor [formControl]="clientForm.controls.lastSeenDate" dateTime="true"
        [placeholder]="'PLACEHOLDER.DATE_TIME' | translate"></app-date-input>
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <app-date-input #controlAnchor [formControl]="clientForm.controls.lastTransactionDate" dateTime="true"
        [placeholder]="'PLACEHOLDER.DATE_TIME' | translate"></app-date-input>
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <input #controlAnchor suffix="$" mask="separator.2" [formControl]="clientForm.controls.account"
        class="sdwi-input" />
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <app-form-field class="no-label">
      <app-select #controlAnchor [formControl]="clientForm.controls.status">
        <app-option *ngFor="let option of statusOptions" [value]="option.value">{{option.viewValue  | translate}}</app-option>
      </app-select>
      <app-field-error-label></app-field-error-label>
    </app-form-field>
  </td>
  <td>
    <div class="cell-buttons">
      <button (click)="handleUpdateRow(client)" class="sdwi-button action-button">
        {{'BUTTONS.UPDATE' | translate}}
      </button>
      <button (click)="handleCancelEdit()" class="sdwi-button action-button">
        {{'BUTTONS.CANCEL'  | translate }}</button>
    </div>
  </td>
</ng-template>

<ng-template #rowCreateTpl>
  <tr>
    <td>
      <app-form-field class="no-label">
        <input #controlAnchor [formControl]="clientForm.controls.fullName" class="sdwi-input" type="text" />
        <app-field-error-label></app-field-error-label>
      </app-form-field>
    </td>
    <td>
      <app-form-field class="no-label">
        <app-date-input #controlAnchor [formControl]="clientForm.controls.DOB"
          [placeholder]="'PLACEHOLDER.DATE' | translate"></app-date-input>
        <app-field-error-label></app-field-error-label>
      </app-form-field>
    </td>
    <td>
      <app-form-field class="no-label">
        <input #controlAnchor [formControl]="clientForm.controls.email" class="sdwi-input" type="text" />
        <app-field-error-label></app-field-error-label>
      </app-form-field>
    </td>
    <td>
      <app-form-field class="no-label">
        <input [showMaskTyped]="true" #controlAnchor [mask]="phoneNumberMask"
          [formControl]="clientForm.controls.phoneNumber" class="sdwi-input" type="text" />
        <app-field-error-label></app-field-error-label>
      </app-form-field>
    </td>
    <td>
      <app-form-field class="no-label">
        <app-date-input #controlAnchor [formControl]="clientForm.controls.lastSeenDate" dateTime="true"
          [placeholder]="'PLACEHOLDER.DATE_TIME' | translate"></app-date-input>
        <app-field-error-label></app-field-error-label>
      </app-form-field>
    </td>
    <td>
      <app-form-field class="no-label">
        <app-date-input #controlAnchor [formControl]="clientForm.controls.lastTransactionDate" dateTime="true"
          [placeholder]="'PLACEHOLDER.DATE_TIME' | translate"></app-date-input>
        <app-field-error-label></app-field-error-label>
      </app-form-field>
    </td>
    <td>
      <app-form-field class="no-label">
        <input #controlAnchor suffix="$" mask="separator.2" [formControl]="clientForm.controls.account"
          class="sdwi-input" type="text" />
        <app-field-error-label></app-field-error-label>
      </app-form-field>
    </td>
    <td>
      <app-form-field class="no-label">
        <app-select #controlAnchor [formControl]="clientForm.controls.status">
          <app-option *ngFor="let option of statusOptions" [value]="option.value">{{option.viewValue | translate}}</app-option>
        </app-select>
        <app-field-error-label></app-field-error-label>
      </app-form-field>
    </td>
    <td>
      <div class="cell-buttons">
        <button (click)="handleCreate()" class="sdwi-button action-button">
          {{ 'BUTTONS.UPDATE' | translate}}
        </button>
        <button (click)="handleCancelCreate()" class="sdwi-button action-button">
          {{ 'BUTTONS.CANCEL' | translate}}
        </button>
      </div>
    </td>
  </tr>
</ng-template>
